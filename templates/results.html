{% extends "base.html" %}

{% block main %}

<div class="container mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Search Results</li>
        </ol>
    </nav>

    {% if results %}
    <!-- Custom Descriptions based on City -->
{% set desc = "Experience luxury in the heart of the city. Rated 9.7/10 by guests." %}
{% if results.hotel.city == 'London' %}{% set desc = "Located near Big Ben and The Shard. Excellent location for tourists." %}{% endif %}
{% if results.hotel.city == 'Manchester' %}{% set desc = "Modern suites near Old Trafford. Perfect for business and leisure." %}{% endif %}
{% if results.hotel.city == 'Edinburgh' %}{% set desc = "Historic charm with castle views. Top rated for couples." %}{% endif %}
{% if results.hotel.city == 'Aberdeen' %}{% set desc = "Cozy retreat near the granite coastline. Peaceful and quiet." %}{% endif %}

    <h2>{{ results.hotel.city }} Availability</h2>
    <p class="text-muted">{{ results.dates.in }} to {{ results.dates.out }} • {{ results.guests }} Guests</p>
    
    <div class="card shadow-sm mb-4 border-0">
        <div class="row g-0">
            <!-- 1. IMAGE COLUMN -->
            <div class="col-md-4">
                <img src="{{ url_for('static', filename='images/' + results.hotel.city + '.jpg') }}" 
                     class="img-fluid rounded-start h-100" 
                     style="object-fit: cover; min-height: 250px;"
                     onerror="this.src='{{ url_for('static', filename='images/banner.jpg') }}'">
            </div>
            
            <!-- 2. INFO COLUMN -->
            <div class="col-md-5 p-3">
                <div class="d-flex justify-content-between">
                    <h4 class="card-title text-primary fw-bold">{{ results.hotel.city }} Grand Hotel</h4>
                    <span class="badge bg-primary d-flex align-items-center">
                        <i class="bi bi-star-fill me-1"></i> 5.0
                    </span>
                </div>
                
                <p class="small text-primary fw-bold mb-1">
                    <i class="bi bi-geo-alt-fill"></i> Excellent location — Rated 9.7/10!
                </p>
                <p class="card-text text-muted small">{{ desc }}</p>

                <!-- Facilities Grid -->
                <div class="row g-2 mb-3">
                    <div class="col-6 small"><i class="bi bi-wifi text-success"></i> Free High-Speed WiFi</div>
                    <div class="col-6 small"><i class="bi bi-p-circle"></i> Free Parking</div>
                    <div class="col-6 small"><i class="bi bi-cup-hot"></i> fabulous Breakfast</div>
                    <div class="col-6 small"><i class="bi bi-wind"></i> Air Conditioning</div>
                    {% if results.room.type_name == 'Family' %}
                        <div class="col-6 small fw-bold text-dark"><i class="bi bi-people"></i> Family Suite</div>
                    {% endif %}
                </div>

                <div class="alert alert-light border p-2 small">
                    <strong>Room Selected:</strong> {{ results.room.type_name }} <br>
                    <span class="text-success fw-bold">✓ Free Cancellation</span> (If > 60 days away)
                </div>
            </div>

            <!-- 3. PRICE COLUMN -->
            <div class="col-md-3 bg-light p-3 border-start d-flex flex-column justify-content-center align-items-end">
                <div class="text-end mb-3">
                    <small class="text-muted">Total Price for Stay</small>
                    
                    {% if results.discount > 0 %}
                        <div class="text-decoration-line-through text-muted small">£{{ "%.2f"|format(results.price + results.discount) }}</div>
                        <div class="fs-3 fw-bold text-success">£{{ results.price }}</div>
                        <span class="badge bg-success">Save £{{ results.discount }}</span>
                    {% else %}
                        <div class="fs-3 fw-bold text-dark">£{{ results.price }}</div>
                    {% endif %}
                    
                    <small class="text-muted d-block mt-1">Includes taxes & fees</small>
                </div>

                <div class="w-100">
                    {% if session.get('loggedin') %}
                        <form action="{{ url_for('book') }}" method="POST">
                            <input type="hidden" name="room_id" value="{{ results.room.id }}">
                            <input type="hidden" name="check_in" value="{{ results.dates.in }}">
                            <input type="hidden" name="check_out" value="{{ results.dates.out }}">
                            <input type="hidden" name="guests" value="{{ results.guests }}">
                            <input type="hidden" name="total_price" value="{{ results.price }}">
                            <input type="hidden" name="discount" value="{{ results.discount }}">
                            
                            <button class="btn btn-primary w-100 mb-2 fw-bold">I'll Reserve > </button>
                            
                        </form>
                    {% else %}
                        <a href="{{ url_for('login') }}" class="btn btn-primary w-100">Login to Book</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% else %}
        <!--SHOWS IF NO ROOMS ARE FOUND -->
        <div class="alert alert-warning py-5 text-center shadow-sm">
            <i class="bi bi-exclamation-triangle fs-1"></i>
            <h3 class="mt-3">No Rooms Available</h3>
            <p>We couldn't find any rooms matching your criteria for these dates. Please try different dates or another location.</p>
            <a href="/" class="btn btn-primary mt-3">Back to Search</a>
        </div>
    {% endif %}
</div>
{% endblock %}